# 内存管理

## 内存分区

| 内存分区        | 存储内容                             | 生命周期                   | 分配/回收方式 |
| :-----:        | :-----:                             | :-----:                         | :-----: |
| 栈(Stack)      | 局部变量、函数参数、返回值             | 函数                             | 编译器 |
| 堆（Heap）     | 动态分配的对象、数组（new/malloc 分配）| 手动创建，手动回收（delete/free） | 程序员手动控制（易漏删） |
| 全局/静态区     | 全局变量、静态变量(static) | 程序启动时创建，程序退出时销毁 | 编译器自动分配/回收 |
| 常量区 (RODATA) | 字符串常量、const 全局常量 | 程序启动时创建，程序退出时销毁 | 编译器自动分配 / 回收 |
| 代码区（Code）	  | 程序指令（二进制代码） |	程序加载时创建，程序退出时销毁 | 操作系统加载时分配 |

### 栈和堆区别

## 内存管理

### 手动管理

1. C 风格：```malloc```/```calloc```/```realloc```/```free```

+ 仅分配内存，```不调用对象构造函数```（不适用于 C++ 类对象）；
+ 需手动计算内存大小（```sizeof```）；
+ 分配失败返回```nullptr```，需手动检查；

2. C++ 风格：```new```/```delete```/```new[]```/```delete[]```

+ 不仅分配内存，还会调用对象的**构造函数**（创建对象时）；
+ 释放时调用析构函数（销毁对象时，释放成员资源）；
+ 分配失败抛出```std::bad_alloc```异常（而非返回nullptr）

```C++
new T
delete ptr

new T[n]
delete[] ptr

new(nothrow) T    // 分配失败返回 nullptr（不抛异常）
```
